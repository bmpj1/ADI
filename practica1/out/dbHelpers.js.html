<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: dbHelpers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: dbHelpers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const knex = require("knex");
const config = require("../knexfile");
const db = process.env.NODE_ENV.toString()==="test" ? 
    knex(config.test) :
    knex(config.development);

/** 
 * Aqui escribimos las funciones que queremos que
 * se puedan acceder desde otros archivos.
 */ 
module.exports = {
    add,
    tabla,
    findById,
    remove,
    update,
    login
}

/**
 * Metodo que permite agregar una tupla a la BDD. Mirar la migration de la tabla deseada para ver los campos.
 * @author Brian Mathias Pesci Juliani
 * @param {string} tabla - String con el nombre de la tabla a trabajar
 * @param {*} tupla - Body de la peticion (los atributos deben coincidir con los de la migration de la tabla)
 * @returns {int} - ID del objeto insertado
 */
async function add(tabla, tupla) {
    const [id] = await db(tabla).insert(tupla)
    /*
    .then(() => {
        return findById(id)
    })
    */
    return id;
}

/**
 * Metodo que devuelve una COLLECTION DE TODA UNA TABLA
 * @author Brian Mathias Pesci Juliani
 * @param {string} tabla - String con el nombre de la tabla a trabajar
 * @returns {Array} - Array con todas los datos de la tabla
 */
async function tabla(tabla) {
    const result = await db(tabla).paginate({perPage: 10, currentPage: 1})
    return result
}

/**
 * Metodo que permite obtener una TUPLA DE UNA TABLA
 * @author Brian Mathias Pesci Juliani
 * @param {string} tabla - String con el nombre de la tabla a trabajar
 * @param {int} id - ID del objeto a consultar
 * @returns {*} - Datos del objeto consultado
 */
async function findById(tabla, id) {
    const result = await db(tabla)
    .where({ id })  // usar .where({ id:id }) si el nombre del parametro no coincide con el nombre en la tabla
    .first()    // .first() evita siga buscando coincidencias en la tabla
    
    return result
}

/**
 * Metodo que permite ELIMINAR UNA TUPLA DE UNA TABLA
 * @author Brian Mathias Pesci Juliani
 * @param {string} tabla - String con el nombre de la tabla a trabajar
 * @param {int} id - ID del objeto
 * @returns {int} - Numero de filas afectadas por el delete
 */
async function remove(tabla, id) {
    const result = await db(tabla)
    .where({ id })
    .del()

    return result
}

/**
 * Metodo que permite ACTUALIZAR LOS DATOS DE UNA TUPLA DE LA TABLA
 * @author Brian Mathias Pesci Juliani
 * @param {string} tabla - String con el nombre de la tabla a trabajar 
 * @param {int} id - ID del objeto
 * @param {*} changes - Cambios a realizar sobre el objeto
 * @returns {int} - Numero de filas afectadas por el update
 */
async function update(tabla, id, changes) {
    const result = await db(tabla)
    .where({ id })
    .first()
    .update(changes, [id])

    return result
}

/**
 * Metodo que controla el login
 * @param {string} email 
 * @param {string} password 
 * @returns {*} - Datos del usuario logueado
 */
async function login(email, password) {
    const result = await db("usuarios")
    .where( {email, password} )
    .first()

    return result
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#add">add</a></li><li><a href="global.html#findById">findById</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#remove">remove</a></li><li><a href="global.html#tabla">tabla</a></li><li><a href="global.html#update">update</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Mon Nov 09 2020 03:39:32 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
